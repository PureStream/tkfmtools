{"version":3,"sources":["webpack://tkfmtools/./src/data/byStageToItem.js","webpack://tkfmtools/./src/pages/items/drop/filter.js"],"names":["itemDropData","stageDropData","chapter","stages","forEach","stage","materials","trainItems","expPotions","rest","items","item","newDrop","rarity","id","drop","push","i","toString","btnLayoutConfig","1360","992","768","624","0","410","StyledToggleButton","styled","MyToggleButton","ItemImg","ImageSupplier","ItemFilterPanel","filterBtnValue","filterBy","clearBtnValue","useLanguage","userLanguage","pageString","itemString","MyHeader","title","filter","itemPanelTitle","end","onClick","tooltipText","deleteTooltip","DeleteIcon","border","MyToggleButtonGroup","type","value","onChange","layoutConfig","Object","entries","map","entry","idx","length","key","name","alt","ImgTh","SortableTh","TableImg","ItemTh","requestSort","getSortDirection","sortedResult","tableHead","direction","TableHead","TableBody","energy","sortFunc","sortableItems","sortConfig","toStageKey","splits","split","parseInt","includes","sort","a","b","aKey","bKey","useState","data","isHelpModalOpen","state","setState","val","filteredStages","concat","drops","every","queryItem","flag","newStage","handelHelpModal","boolean","Head","helmet","description","path","Panels","panelsWidth","head","body","defaultSortKey","handleModalOpen","height","striped","helpModal","open","onClose","content","ariaLabelledby","ariaDescribedby"],"mappings":"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","file":"component---src-pages-items-drop-filter-js-1551e48244b7a9b00ca9.js","sourcesContent":["import stageDropData from 'data/stageDrop.json';\r\n\r\nlet itemDropData = {}\r\n\r\n// from stages\r\nstageDropData.forEach(chapter => {\r\n    chapter.stages.forEach(stage => {\r\n        const { materials, trainItems, expPotions, ...rest } = stage\r\n\r\n        const dropItems = [materials, trainItems, expPotions]\r\n\r\n        dropItems.forEach(items => {\r\n            items.forEach(item => {\r\n                const newDrop = { chapter: chapter.chapter, rarity: item.rarity, ...rest }\r\n\r\n                if (itemDropData[item.id]) {\r\n                    itemDropData[item.id].drop.push(newDrop)\r\n                } else {\r\n                    itemDropData[item.id] = {\r\n                        drop: [newDrop]\r\n                    }\r\n                }\r\n            })\r\n        })\r\n    })\r\n})\r\n\r\n// not available from stages\r\n//legendary items\r\n\r\nfor (let i = 1; i < 11; i++) {\r\n    itemDropData[(500 + i).toString()] = { drop: [] }\r\n}\r\n\r\n// skill items\r\nfor (let i = 1; i < 3; i++) {\r\n    itemDropData[(900 + i).toString()] = { drop: [] }\r\n}\r\n\r\nexport default itemDropData","import React, { useState } from 'react';\r\nimport styled from 'styled-components';\r\n\r\nimport Panels from 'containers/Panels';\r\nimport { useLanguage } from 'containers/LanguageProvider';\r\n\r\nimport Head from \"components/Head\";\r\nimport { ResultPanel, SortableTh } from 'components/FilterComponents';\r\nimport MyHeader from 'components/MyHeader';\r\nimport { HeaderIconButton } from 'components/MyIconButton';\r\nimport MyToggleButtonGroup, { MyToggleButton } from 'components/MyToggleButtonGroup';\r\nimport ImageSupplier from 'components/ImageSupplier';\r\nimport { TextModal } from 'components/MyModal';\r\nimport { DeleteIcon } from 'components/icon';\r\n\r\nimport itemDropData from 'data/byStageToItem';\r\nimport stageDropData from 'data/stageDrop.json';\r\n\r\nconst btnLayoutConfig = {\r\n    'en': {\r\n        1360: 4,\r\n        992: 3,\r\n        768: 4,\r\n        624: 3,\r\n        0: 2\r\n    },\r\n    'zh-TW': {\r\n        1360: 5,\r\n        992: 4,\r\n        768: 5,\r\n        624: 4,\r\n        410: 3,\r\n        0: 2,\r\n    }\r\n}\r\n\r\nconst StyledToggleButton = styled(MyToggleButton)`\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-size: .85rem;\r\n`\r\nconst ItemImg = styled(ImageSupplier)`\r\n    width: 2.26rem; \r\n    height: 2.26rem;\r\n`\r\nconst ItemFilterPanel = ({\r\n    filterBtnValue,\r\n    filterBy,\r\n    clearBtnValue\r\n}) => {\r\n    const { userLanguage, pageString, itemString } = useLanguage()\r\n\r\n    return (<>\r\n        <MyHeader\r\n            title={pageString.items.drop.filter.itemPanelTitle}\r\n            end={\r\n                <HeaderIconButton\r\n                    onClick={clearBtnValue}\r\n                    tooltipText={pageString.items.drop.filter.deleteTooltip}\r\n                >\r\n                    {DeleteIcon}\r\n                </HeaderIconButton>\r\n            }\r\n            border\r\n        />\r\n        <MyToggleButtonGroup\r\n            type='checkbox'\r\n            value={filterBtnValue}\r\n            onChange={filterBy}\r\n            layoutConfig={btnLayoutConfig[userLanguage]}\r\n        >\r\n            {Object.entries(itemDropData).map((entry, idx) => {\r\n                if (entry[1].drop.length === 0) return true\r\n\r\n                return (\r\n                    <StyledToggleButton\r\n                        value={entry[0]}\r\n                        key={idx}\r\n                    >\r\n                        <ItemImg\r\n                            name={`item_${entry[0]}`}\r\n                            alt=''\r\n                        />\r\n                        {itemString.name[entry[0]]}\r\n                    </StyledToggleButton>\r\n                )\r\n            })}\r\n        </MyToggleButtonGroup>\r\n    </>)\r\n}\r\n\r\nconst ImgTh = styled(SortableTh)`\r\n    &:after {\r\n        position: absolute;\r\n        top: calc(50% - .75rem);\r\n        margin-left: 2rem;\r\n    }\r\n`\r\nconst TableImg = styled(ImageSupplier)`\r\n    width: 1.8rem;\r\n    height: 1.8rem;\r\n`\r\nconst ItemTh = ({\r\n    requestSort,\r\n    getSortDirection,\r\n    sortedResult\r\n}) => {\r\n    const { pageString, itemString } = useLanguage()\r\n\r\n    if (sortedResult.length === 0) {\r\n        return (\r\n            <SortableTh>\r\n                {pageString.items.drop.filter.tableHead[1]}\r\n            </SortableTh>\r\n        )\r\n    }\r\n\r\n    return (\r\n        Object.entries(sortedResult[0]).map((entry, idx) => {\r\n            if (entry[0] === 'stage' || entry[0] === 'energy') {\r\n                return\r\n            }\r\n\r\n            return (\r\n                <ImgTh\r\n                    key={idx}\r\n                    onClick={() => requestSort(entry[0])}\r\n                    direction={getSortDirection(entry[0])}\r\n                >\r\n                    <TableImg\r\n                        name={`item_${entry[0]}`}\r\n                        alt={itemString.name[entry[0]]}\r\n                    />\r\n                </ImgTh>\r\n            )\r\n        })\r\n    )\r\n}\r\n\r\nconst TableHead = ({\r\n    requestSort,\r\n    getSortDirection,\r\n    sortedResult\r\n}) => {\r\n    const { pageString } = useLanguage()\r\n\r\n    return (\r\n        <thead>\r\n            <tr>\r\n                <SortableTh\r\n                    onClick={() => requestSort('stage')}\r\n                    direction={getSortDirection('stage')}\r\n                >\r\n                    {pageString.items.drop.filter.tableHead[0]}\r\n                </SortableTh>\r\n                <ItemTh\r\n                    requestSort={requestSort}\r\n                    getSortDirection={getSortDirection}\r\n                    sortedResult={sortedResult}\r\n                />\r\n                <ImgTh\r\n                    onClick={() => requestSort('energy')}\r\n                    direction={getSortDirection('energy')}\r\n                >\r\n                    <TableImg\r\n                        name='energy'\r\n                        alt={pageString.items.drop.filter.tableHead[2]}\r\n                    />\r\n                </ImgTh>\r\n            </tr>\r\n        </thead>\r\n    )\r\n}\r\n\r\nconst TableBody = ({ sortedResult }) => {\r\n    const { itemString } = useLanguage()\r\n\r\n    return (\r\n        <tbody>\r\n            {sortedResult.map((stage, idx) => {\r\n                return (\r\n                    <tr key={idx}>\r\n                        <td>{stage.stage}</td>\r\n                        {Object.entries(stage).map((entry, idx) => {\r\n                            if (\r\n                                entry[0] === 'stage' ||\r\n                                entry[0] === 'energy'\r\n                            ) {\r\n                                return\r\n                            }\r\n\r\n                            return (\r\n                                <td key={idx}>\r\n                                    {itemString.rarity[entry[1]]}\r\n                                </td>\r\n                            )\r\n                        })}\r\n                        <td>{stage.energy}</td>\r\n                    </tr>\r\n                )\r\n            })}\r\n        </tbody>\r\n    )\r\n}\r\n\r\nconst sortFunc = (sortableItems, sortConfig) => {\r\n    const toStageKey = (stage) => {\r\n        const splits = stage.split('-')\r\n\r\n        return (\r\n            parseInt(splits[0]) * 1000 +\r\n            parseInt(splits[1].split(' ')[0]) * 10 +\r\n            (splits[1].includes('free') ? 1 : 0) +\r\n            (splits.length > 2 ? parseInt(splits[2]) : 0)\r\n        )\r\n    }\r\n\r\n    sortableItems.sort((a, b) => {\r\n        let aKey\r\n        let bKey\r\n        if (sortConfig.key === 'stage') {\r\n            aKey = toStageKey(a.stage)\r\n            bKey = toStageKey(b.stage)\r\n        } else {\r\n            aKey = a[sortConfig.key]\r\n            bKey = b[sortConfig.key]\r\n        }\r\n        if (aKey < bKey) {\r\n            return sortConfig.direction === 'asc' ? -1 : 1\r\n        }\r\n        if (aKey > bKey) {\r\n            return sortConfig.direction === 'asc' ? 1 : -1\r\n        }\r\n        return 0\r\n    })\r\n}\r\n\r\nconst Filter = () => {\r\n    const { pageString } = useLanguage()\r\n\r\n    const [state, setState] = useState({\r\n        filterBtnValue: [],\r\n        data: [],\r\n        isHelpModalOpen: false,\r\n    })\r\n\r\n    const filterBy = (val) => {\r\n        if (val.length === 0) {\r\n            setState((state) => ({\r\n                ...state,\r\n                filterBtnValue: val,\r\n                data: [],\r\n            }))\r\n            return;\r\n        }\r\n\r\n        const stageDrop = [].concat(...stageDropData.map(chapter => (\r\n            chapter.stages.map(stage => {\r\n                const { materials, trainItems, expPotions, ...rest } = stage\r\n                return {\r\n                    ...rest,\r\n                    drops: materials.concat(trainItems, expPotions),\r\n                    chapter: chapter.chapter\r\n                }\r\n            })\r\n        )))\r\n\r\n        let filteredStages = stageDrop.filter(stage => (\r\n            val.every(queryItem => {\r\n                let flag = false\r\n                stage.drops.forEach(drop => {\r\n                    if (drop.id === queryItem) {\r\n                        flag = true\r\n                        return false\r\n                    }\r\n                })\r\n                return flag\r\n            })\r\n        ))\r\n\r\n        filteredStages = filteredStages.map(stage => {\r\n            const parsedStage = stage.chapter + '-' + stage.stage\r\n            const newStage = { stage: parsedStage, energy: stage.energy }\r\n            stage.drops.forEach(item => {\r\n                if (val.includes(item.id)) {\r\n                    newStage[item.id] = item.rarity\r\n                }\r\n            })\r\n            return newStage\r\n        })\r\n\r\n        setState((state) => ({\r\n            ...state,\r\n            filterBtnValue: val,\r\n            data: filteredStages,\r\n        }))\r\n    }\r\n\r\n    const handelHelpModal = (boolean) => () => {\r\n        setState((state) => ({\r\n            ...state,\r\n            isHelpModalOpen: boolean,\r\n        }))\r\n    }\r\n\r\n    return (<>\r\n        <Head\r\n            title={pageString.items.drop.filter.helmet.title}\r\n            description={pageString.items.drop.filter.helmet.description}\r\n            path='/items/drop/filter/'\r\n        />\r\n        <Panels panelsWidth={['62%', '38%']}>\r\n            <ItemFilterPanel\r\n                filterBtnValue={state.filterBtnValue}\r\n                filterBy={filterBy}\r\n                clearBtnValue={() => filterBy([])}\r\n            />\r\n            <ResultPanel\r\n                data={state.data}\r\n                head={<TableHead />}\r\n                body={<TableBody />}\r\n                sortFunc={sortFunc}\r\n                defaultSortKey={state.filterBtnValue[0]}\r\n                handleModalOpen={handelHelpModal(true)}\r\n                height='calc(100vh - 16rem)'\r\n                striped\r\n            />\r\n        </Panels>\r\n        <TextModal\r\n            title={pageString.items.drop.filter.helpModal.title}\r\n            open={state.isHelpModalOpen}\r\n            onClose={handelHelpModal(false)}\r\n            content={pageString.items.drop.filter.helpModal.content}\r\n            ariaLabelledby=\"help-modal-title\"\r\n            ariaDescribedby=\"help-modal-description\"\r\n        />\r\n    </>)\r\n}\r\n\r\nexport default Filter"],"sourceRoot":""}